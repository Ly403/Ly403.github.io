<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> ç¦»æ•£å‹æµåŒ¹é…æ¨¡å‹ï¼ˆ3ï¼‰ | Yi Liu's Homepage. ğŸ˜€ </title> <meta name="author" content="Yi LIU"> <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. "> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?b05f9a0b7405d7c8c89c7465593dea81"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?dadeb9c5d1fd12bc8d37475657446863"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?1fefb6021bf36010f25ea1cef24af84e"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?53a094b51ed1d1e025731eb00d240058" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%91%8B&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://ly403.github.io/blog/2025/%E7%A6%BB%E6%95%A3%E6%B5%81%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-3/"> <script src="/assets/js/theme.js?f2531f05c6f8e1622518f4f5a1e385b1"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?46af317e693b09921dcb92261d123fbc" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Yi Liu's Homepage. ğŸ˜€ </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/teaching/">teaching</a> </div> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">ç¦»æ•£å‹æµåŒ¹é…æ¨¡å‹ï¼ˆ3ï¼‰</h1> <p class="post-meta"> Created on January 20, 2025 </p> <p class="post-tags"> <a href="/blog/2025"> <i class="fa-solid fa-calendar fa-sm"></i> 2025 </a> Â  Â· Â  <a href="/blog/tag/formatting"> <i class="fa-solid fa-hashtag fa-sm"></i> formatting</a> Â  <a href="/blog/tag/math"> <i class="fa-solid fa-hashtag fa-sm"></i> math</a> Â  Â· Â  <a href="/blog/category/flow-matching"> <i class="fa-solid fa-tag fa-sm"></i> Flow_Matching</a> Â  <a href="/blog/category/discrete-flow-matching"> <i class="fa-solid fa-tag fa-sm"></i> Discrete_Flow_Matching</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p>æ¥ç€ä¸Šæ¬¡è¯´çš„DFMçš„åˆ†è§£æŠ€å·§ï¼Œç»§ç»­å­¦ä¹ DFMçš„æœ€åä¸€éƒ¨åˆ†â€”â€”æ··åˆè·¯å¾„ï¼ˆMixture pathsï¼‰ã€‚</p> <h2 id="æ··åˆè·¯å¾„mixture-paths">æ··åˆè·¯å¾„ï¼ˆMixture pathsï¼‰</h2> <p>æˆ‘ä»¬åœ¨æ­¤å‰çš„æ–‡ç« é‡Œé¢å·²ç»è®²è§£äº†åˆ†è§£æŠ€å·§<sup id="fnref:1"><a href="#fn:1" class="footnote" rel="footnote" role="doc-noteref">1</a></sup>ï¼Œå¾—åˆ°äº†åˆ†è§£çš„ï¼ˆè¾¹ç¼˜/æ¡ä»¶ï¼‰æ¦‚ç‡è·¯å¾„ã€åˆ†è§£çš„ï¼ˆè¾¹ç¼˜/æ¡ä»¶ï¼‰é€Ÿç‡ï¼Œä»¥åŠçŸ¥é“äº†ä»–ä»¬ä¹‹é—´çš„å…³ç³»ï¼ˆ<sup id="fnref:1:1"><a href="#fn:1" class="footnote" rel="footnote" role="doc-noteref">1</a></sup>ä¸­çš„å‘½é¢˜2å’Œå®šç†16ï¼‰ã€‚ç°åœ¨æˆ‘ä»¬è¦ç€æ‰‹è®¾è®¡å‡ºä¸€ä¸ªå…·ä½“çš„DFMäº†ï¼Œç±»ä¼¼FM<sup id="fnref:2"><a href="#fn:2" class="footnote" rel="footnote" role="doc-noteref">2</a></sup>ä¸€æ ·ï¼Œ<strong>æˆ‘ä»¬å¯ä»¥ä»åˆ†è§£æ¡ä»¶æ¦‚ç‡è·¯å¾„ç€æ‰‹ï¼Œç„¶åå¾—åˆ°ç›®æ ‡åˆ†è§£æ¡ä»¶é€Ÿç‡ï¼Œä½¿ç”¨ç¥ç»ç½‘ç»œé¢„æµ‹åˆ†è§£æ¡ä»¶é€Ÿç‡ï¼Œæœ€åä½¿ç”¨åˆ†è§£CDFMæŸå¤±ï¼ˆ<sup id="fnref:1:2"><a href="#fn:1" class="footnote" rel="footnote" role="doc-noteref">1</a></sup>ä¸­å…¬å¼14ï¼‰æ¥è®­ç»ƒæ¨¡å‹ã€‚</strong></p> <p>æˆ‘ä»¬ä»¥$Z=(X_0,X_1) \sim \pi_{0,1}(X_0,X_1)$ä¸ºæ¡ä»¶ï¼ˆ$X_0$å’Œ$X_1$ä¸ºä»»æ„é…å¯¹ï¼‰ï¼Œé‚£ä¹ˆåˆ†è§£çš„æ¡ä»¶æ¦‚ç‡è·¯å¾„å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å½¢å¼ï¼š</p> \[p_{t\mid 0,1}^i (x^i\mid x_0,x_1)=\kappa_t\delta(x^i,x_1^i) + (1-\kappa_t)\delta(x^i,x_0^i) \tag{1}\] <p>è¿™ä¸ªåšæ³•ç±»ä¼¼Rectified Flowï¼ˆ<sup id="fnref:3"><a href="#fn:3" class="footnote" rel="footnote" role="doc-noteref">3</a></sup>ä¸­å…¬å¼1ï¼‰ï¼Œåªæ˜¯ä½¿ç”¨äº†æ›´generalçš„$\kappa_t$ä½œä¸ºç³»æ•°ï¼Œ$\kappa : [0,1] \to [0,1]$å°±ç±»ä¼¼æ‰©æ•£æ¨¡å‹é‡Œé¢çš„å™ªå£°è°ƒåº¦å™¨ï¼Œ$\kappa_t \in C^1([0,1])$ã€‚æ ¹æ®<sup id="fnref:1:3"><a href="#fn:1" class="footnote" rel="footnote" role="doc-noteref">1</a></sup>ä¸­å…¬å¼6ï¼Œæˆ‘ä»¬èƒ½å¾—åˆ°éåˆ†è§£çš„æ¡ä»¶æ¦‚ç‡è·¯å¾„ï¼š</p> \[p_{t\mid 0,1} (x\mid x_0,x_1)=\prod_i p_{t\mid 0,1}^i (x^i\mid x_0,x_1) \tag{2}\] <blockquote> <p>å…³äºå…¬å¼1çš„è¯¦ç»†è§£é‡Šï¼š</p> <p>åˆ†è§£æ¦‚ç‡è·¯å¾„ä¸Šçš„éšæœºå˜é‡$X_t^i \sim p_{t\mid 0,1}^i(\cdot\mid x_0,x_1) $æ»¡è¶³ï¼š</p> \[X_t^i = \begin{cases} x_1^i \quad æ¦‚ç‡ä¸º\kappa_t\\ x_0^i \quad æ¦‚ç‡ä¸º(1-\kappa_t) \end{cases} \tag{3}\] <p>ä¹Ÿå°±æ˜¯å¯¹$t$æ—¶åˆ»çš„ç¬¬$i$ä¸ªtoken $X_t^i$ï¼Œå®ƒè¦ä¹ˆå–æºçŠ¶æ€çš„å€¼$x_0^i$ï¼Œè¦ä¹ˆå–ç›®æ ‡çŠ¶æ€çš„å€¼$x_1^i$ï¼Œå–è¿™ä¸¤ä¸ªå€¼çš„æ¦‚ç‡ä¸æ—¶é—´$t$ç›¸å…³ã€‚</p> </blockquote> <p>ä»å…¬å¼1å’Œ2ç»™å‡ºçš„æ¡ä»¶æ¦‚ç‡è·¯å¾„å¯ä»¥ç®—å‡ºè¾¹ç¼˜æ¦‚ç‡è·¯å¾„ï¼Œå³ï¼š</p> \[p_t(x)=\sum_{x_0,x_1}p_{t\mid 0,1}(x\mid x_0,x_1) p_{0,1}(x_0,x_1) \tag{4}\] <p>éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œ<strong>$p_t(x)$éœ€è¦æ»¡è¶³è¾¹ç¼˜æ¡ä»¶ï¼Œå³$p_0(x) = \delta(x,x_0)$ï¼Œ$p_1(x) = \delta(x,x_1)$ã€‚ä¸ºå®ç°è¿™ä¸ªæ¡ä»¶ï¼Œéœ€è¦è®©$\kappa_0 = 0$ï¼Œ$\kappa_1 = 1$ã€‚</strong></p> <p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“å…¬å¼1æ‰€ç¤ºåˆ†è§£æ¡ä»¶æ¦‚ç‡è·¯å¾„å¯¹åº”çš„åˆ†è§£æ¡ä»¶é€Ÿç‡$u_t^i(y^i,x^i\mid x_0,x_1)$ã€‚ç”±Kolmogorovæ–¹ç¨‹å¯çŸ¥ï¼š</p> \[\cfrac{\mathrm{d}}{\mathrm{d}t}p_{t\mid 0,1}^i(y^i\mid x_0,x_1) = \sum_{x^i}u_t^i(y^i,x^i\mid x_0,x_1)p_{t\mid 0,1}^i(x^i\mid x_0,x_1) \tag{5}\] <p>ç»“åˆå…¬å¼1ç»™å‡ºçš„å…·ä½“åˆ†è§£æ¡ä»¶æ¦‚ç‡è·¯å¾„ï¼Œå¯ä»¥ç®—å‡ºï¼š</p> \[\begin{aligned} \cfrac{\mathrm{d}}{\mathrm{d}t}p_{t\mid 0,1}^i(y^i\mid x_0,x_1)&amp; \overset{å…¬å¼1}{=} \dot \kappa_t\left[\delta(y^i,x_1^i) - \delta(y^i,x_0^i)\right] \\ &amp;\overset{ç”¨å…¬å¼1æ¶ˆå»\delta(y^i,x_0^i)}{=} \dot \kappa_t\left[\delta(y^i,x_1^i) - \cfrac{p^i_{t\mid 0,1}(y^i\mid x_0,x_1)-\kappa_t\delta(y^i,x_1^i)}{1-\kappa_t}\right]\\ &amp;{=} \cfrac{\dot \kappa_t}{1 - \kappa_t}\left[({1-\kappa_t})\delta(y^i,x_1^i) - {p^i_{t\mid 0,1}(y^i\mid x_0,x_1)+\kappa_t\delta(y^i,x_1^i)}\right]\\ &amp;{=} \cfrac{\dot \kappa_t}{1 - \kappa_t} \left[ \delta(y^i,x_1^i) - p^i_{t\mid 0,1}(y^i\mid x_0,x_1) \right]\\ &amp;\overset{(*)}{=}\sum_{x^i} \cfrac{\dot \kappa_t}{1 - \kappa_t} \left[ \delta(y^i,x_1^i) - \delta(y^i,x^i) \right] p^i_{t\mid 0,1}(x^i\mid x_0,x_1)\\ \end{aligned}\tag{6}\] <blockquote> <p>å…³äºï¼ˆ*ï¼‰æ­¥çš„è§£é‡Šå¦‚ä¸‹ï¼š</p> <p>è¿™é‡Œå…¶å®å°±æ˜¯è¦è¯æ˜</p> \[\delta(y^i,x_1^i) - p^i_{t\mid 0,1}(y^i\mid x_0,x_1) = \sum_{x^i} \left[ \delta(y^i,x_1^i) - \delta(y^i,x^i) \right] p^i_{t\mid 0,1}(x^i\mid x_0,x_1) \tag{7}\] <p>æˆ‘ä»¬ä»å³è¾¹å¼€å§‹å˜æ¢ï¼š</p> \[\begin{aligned} \sum_{x^i} \left[ \delta(y^i,x_1^i) - \delta(y^i,x^i) \right] p^i_{t\mid 0,1}(x^i\mid x_0,x_1) &amp;= \sum_{x^i} \left[ \delta(y^i,x_1^i)p^i_{t\mid 0,1}(x^i\mid x_0,x_1) - \delta(y^i,x^i)p^i_{t\mid 0,1}(x^i\mid x_0,x_1) \right]\\ &amp;= \sum_{x^i} \delta(y^i,x_1^i)p^i_{t\mid 0,1}(x^i\mid x_0,x_1) - \sum_{x^i} \delta(y^i,x^i)p^i_{t\mid 0,1}(x^i\mid x_0,x_1) \\ &amp;\overset{(1)}{=} \sum_{x^i} \delta(y^i,x_1^i)p^i_{t\mid 0,1}(x^i\mid x_0,x_1) - p^i_{t\mid 0,1}(y^i\mid x_0,x_1) \\ &amp;\overset{(2)}{=} \delta(y^i,x_1^i) - p^i_{t\mid 0,1}(y^i\mid x_0,x_1) \\ \end{aligned} \tag{8}\] <p>ç¬¬ï¼ˆ1ï¼‰æ­¥æ˜¯deltaå‡½æ•°çš„æ€§è´¨ï¼Œ$\int_x\delta(y,x)f(x)\mathrm{d}x = f(y)$ï¼Œç¬¬ï¼ˆ2ï¼‰æ­¥æ˜¯å› ä¸º$\delta(y^i,x_1^i)$ä¸$x^i$æ— å…³ï¼Œ$\sum_{x^i} p^i_{t\mid 0,1}(x^i\mid x_0,x_1) = 1 $ã€‚</p> </blockquote> <p>å¯¹æ¯”å…¬å¼6çš„æœ€åç»“æœå’Œå…¬å¼5ï¼Œå°±çŸ¥é“ï¼š</p> \[u_t^i(y^i,x^i\mid x_0,x_1) = \cfrac{\dot \kappa_t}{1 - \kappa_t} \left[ \delta(y^i,x_1^i) - \delta(y^i,x^i) \right] \tag{9}\] <p>è¿™æ ·æˆ‘ä»¬å°±çŸ¥é“äº†å…¬å¼1æ‰€ç¤ºçš„åˆ†è§£æ¡ä»¶æ¦‚ç‡è·¯å¾„å¯¹åº”çš„åˆ†è§£æ¡ä»¶é€Ÿç‡$u_t^i(y^i,x^i\mid x_0,x_1)$çš„å…·ä½“å½¢å¼äº†ã€‚</p> <p>Code 9æ˜¯æ··åˆè·¯å¾„çš„å®ç°ä»£ç ã€‚</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/post/DFM31-480.webp 480w,/assets/img/post/DFM31-800.webp 800w,/assets/img/post/DFM31-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/post/DFM31.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> æ··åˆè·¯å¾„çš„å®ç°ä»£ç  </div> <h3 id="é€Ÿç‡åéªŒå‚æ•°åŒ–">é€Ÿç‡åéªŒå‚æ•°åŒ–</h3> <p>ç±»æ¯”æˆ‘ä»¬åœ¨FM<sup id="fnref:2:1"><a href="#fn:2" class="footnote" rel="footnote" role="doc-noteref">2</a></sup>å’Œæ‰©æ•£æ¨¡å‹é‡Œé¢ä¹Ÿä¼šè®²çš„å¤šç§é¢„æµ‹æ–¹å¼ï¼Œä¾‹å¦‚velocity-predictionã€$x_0$-predictionã€$x_1$-predictionï¼Œæˆ‘ä»¬åœ¨DFMé‡Œé¢ä¹Ÿå¯ä»¥ä½¿ç”¨ç±»ä¼¼çš„é¢„æµ‹æ–¹å¼ã€‚</p> <p>æœ€ç®€å•çš„ä¸€ç§ï¼š<strong>ä½¿ç”¨ç¥ç»ç½‘ç»œé¢„æµ‹å…¬å¼9ç»™å‡ºçš„åˆ†è§£æ¡ä»¶é€Ÿç‡$u_t^i(y^i,x^i\mid x_0,x_1)$ï¼Œè¿™å°±æ˜¯velocity-predictionã€‚</strong></p> <p>æ¥ä¸‹æ¥ä»‹ç»DFMé‡Œé¢çš„$x_1$-predictionï¼Œè¿™ä¸ªä¼šç¨å¾®å¤æ‚ä¸€ç‚¹ã€‚</p> <p>æ ¹æ®æˆ‘ä»¬åœ¨<sup id="fnref:1:4"><a href="#fn:1" class="footnote" rel="footnote" role="doc-noteref">1</a></sup>ä¸­è¯æ˜å‡ºæ¥çš„å…¬å¼12ï¼Œå¯ä»¥å¾—åˆ°åœ¨$u_t^i(y^i,x^i\mid x_0,x_1)$å–å…¬å¼9çš„å½¢å¼æ—¶ï¼Œåˆ†è§£è¾¹ç¼˜é€Ÿç‡ä¸ºï¼š</p> \[\begin{aligned} u_t^i(y^i,x) &amp;=\sum_{x_0,x_1} u_t^i(y^i,x^i\mid x_0,x_1)p_{0,1\mid t}(x_0,x_1\mid x)\\ &amp;\overset{å…¬å¼(9)}{=} \sum_{x_0,x_1} \cfrac{\dot \kappa_t}{1 - \kappa_t} \left[ \delta(y^i,x_1^i) - \delta(y^i,x^i) \right] p_{0,1\mid t}(x_0,x_1\mid x)\\ &amp;\overset{å°†x_1^iåˆ†å‡ºæ¥}{=} \sum_{x_1^i}\sum_{x_0,x_1^{\bar i}} \cfrac{\dot \kappa_t}{1 - \kappa_t} \left[ \delta(y^i,x_1^i) - \delta(y^i,x^i) \right] p_{0,1\mid t}(x_0,x_1\mid x)\\ &amp;\overset{åˆ†é…å¾‹}{=} \sum_{x_1^i} \cfrac{\dot \kappa_t}{1 - \kappa_t} \left[ \delta(y^i,x_1^i) - \delta(y^i,x^i) \right]\sum_{x_0,x_1^{\bar i}} p_{0,1\mid t}(x_0,x_1\mid x)\\ \end{aligned} \tag{10}\] <p>å•ç‹¬æŠŠç¬¬äºŒä¸ªæ±‚å’Œå¼æ‹¿å‡ºæ¥ï¼Œè®°ä¸ºï¼š</p> \[p_{1\mid t}^i(x_1^i\mid x) = \sum_{x_0,x_1^{\bar i}} p_{0,1\mid t}(x_0,x_1\mid x) \overset{(*)}{=}\mathbb{E}\left[ \delta(x_1^i,X_1^i) \mid X_t = x \right] \tag{11}\] <blockquote> <p>å…³äºå…¬å¼11ä¸­ï¼ˆ*ï¼‰æ­¥éª¤çš„è¯¦ç»†è¯´æ˜ï¼š</p> \[\begin{aligned} p_{1\mid t}^i(x_1^i\mid x) &amp;= \sum_{x_0,x_1^{\bar i}} p_{0,1\mid t}(x_0,x_1\mid x)\\ &amp;\overset{æ‹†å¼€x_1}{=} \sum_{x_0,x_1^{\bar i}} p_{0,1\mid t}(x_0,x_1^{\bar i},x_1^i\mid x)\\ &amp;\overset{\deltaå‡½æ•°çš„æ€§è´¨}{=} \sum_{x_0,x_1^{\bar i}}\sum_{X_1^i}\delta(x_1^i,X_1^i) p_{0,1\mid t}(x_0,x_1^{\bar i},X_1^i\mid x)\\ &amp;=\mathbb{E}\left[ \delta(x_1^i,X_1^i) \mid X_t = x \right] \end{aligned} \tag{12}\] </blockquote> <p>æˆ‘ä»¬å¯ä»¥ç”¨ç¥ç»ç½‘ç»œå»å­¦ä¹ åéªŒåˆ†å¸ƒ$p_{1\mid t}^{\theta,i}(x_1^i\mid x)$ï¼Œ$\theta$ä¸ºç¥ç»ç½‘ç»œçš„å‚æ•°ã€‚è¿™å°±æ˜¯ç¦»æ•£ç‰ˆçš„$x_1$-predictionã€‚</p> <p>è¿™æ ·ç†è§£ï¼šä»¥æ–‡æœ¬ä¸ºä¾‹ï¼Œ<strong>$x$æ˜¯æ—¶é—´$t$æ—¶çš„â€œåŠ å™ªâ€æ–‡æœ¬ï¼ˆä½†å…¶å®è¯´â€œåŠ å™ªâ€œä¸å‡†ç¡®ï¼Œå› ä¸ºDFMçš„åˆå§‹çŠ¶æ€$x_0$æ˜¯ä¸€ä¸ªå…¨maskçš„æ–‡æœ¬ï¼Œ$x$æ›´ç±»ä¼¼ä¸€ä¸ªå¤„äºä¸­é—´çŠ¶æ€çš„æ–‡æœ¬ï¼‰ã€‚$x$ä½œä¸ºç¥ç»ç½‘ç»œçš„è¾“å…¥ï¼Œç¥ç»ç½‘ç»œé¢„æµ‹$x_1^i$ï¼Œ$i\in [d]$è¡¨ç¤ºè¿™æ˜¯$x_1$çš„ç¬¬$i$ä¸ªtokenï¼Œ$d$ä¸ºå¥é•¿ã€‚ç¥ç»ç½‘ç»œä¸€æ¬¡é¢„æµ‹æ‰€æœ‰tokençš„å•æ­¥å˜åŒ–æ¦‚ç‡ï¼Œæ¯ä¸ªtokenå…±æœ‰$K$ç§å˜åŒ–æƒ…å†µï¼ˆ$K$ä¸ºvocabularyçš„å¤§å°ï¼‰ï¼Œç¥ç»ç½‘ç»œçš„è¾“å‡ºå‘é‡çš„ç»´åº¦å°±æ˜¯$d\cdot K$ã€‚</strong></p> <h3 id="æ··åˆè·¯å¾„çš„cdfmæŸå¤±">æ··åˆè·¯å¾„çš„CDFMæŸå¤±</h3> <p>æˆ‘ä»¬åŸºäº$x_1$-predictionï¼Œå³é¢„æµ‹$p_{1\mid t}^{\theta,i}(x_1^i\mid x)$ï¼Œç»§ç»­è®¨è®ºå…¬å¼1æ‰€ç¤ºæ··åˆè·¯å¾„æƒ…å†µä¸‹çš„CDFMæŸå¤±ã€‚è¿™é‡Œä¼šæœ‰ä¸¤ç§åšæ³•ã€‚</p> <p>ç»“åˆå…¬å¼11ï¼Œå¦‚æœç›´æ¥å¯¹æ¯”åéªŒæ¦‚ç‡ï¼Œåˆ™CDFMæŸå¤±å¯ä»¥å†™ä¸ºï¼š</p> \[L_{CDFM}(\theta) = \mathbb{E}_{t,X_0,X_1,X_t} D_{X_t}\left( \delta(\cdot,X_1^i),p_{1\mid t}^{\theta,i}(\cdot\mid X_t) \right) \tag{13}\] <p>$\delta(\cdot,X_1^i)$ï¼Œ$p_{1\mid t}^{\theta,i}(\cdot\mid X_t)$éƒ½æ˜¯æ¦‚ç‡è´¨é‡å‡½æ•°ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨KLæ•£åº¦è¡¡é‡äºŒè€…ä¹‹é—´çš„è·ç¦»ï¼Œå³å–Bregmanæ•£åº¦ä¸ºKLæ•£åº¦ï¼Œå¾—åˆ°ï¼š</p> \[L_{CDFM}(\theta) = - \mathbb{E}_{t,X_0,X_1,X_t} \log p_{1\mid t}^{\theta,i}(X_1^i\mid X_t) + \text{const} \tag{14}\] <p>è¿™æ˜¯ç¬¬ä¸€ç§åšæ³•ã€‚</p> <blockquote> <p>å…³äºå…¬å¼14çš„è¯¦ç»†è¯´æ˜ï¼š</p> <p>KLæ•£åº¦çš„å…¬å¼æ˜¯ï¼š$D(p,q)=\sum_{\alpha \in \mathcal{T}}p(\alpha)\log\cfrac{p(\alpha)}{q(\alpha)}$ã€‚åœ¨é€‰æ‹©KLæ•£åº¦ä¸ºBregmanæ•£åº¦åï¼Œå…¬å¼13å¯ä»¥åŒ–ä¸ºï¼š</p> \[\begin{aligned} L_{CDFM}(\theta) &amp;= \mathbb{E}_{t,X_0,X_1,X_t} \sum_{X_1^i} \delta(x_1^i,X_1^i) \log\cfrac{\delta(x_1^i,X_1^i)}{p_{1\mid t}^{\theta,i}( X_1^i\mid X_t)}\\ &amp;=\mathbb{E}_{t,X_0,X_1,X_t} \sum_{X_1^i}\left[ \delta(x_1^i,X_1^i) \log{\delta(x_1^i,X_1^i)} - \delta(x_1^i,X_1^i) \log{p_{1\mid t}^{\theta,i}( X_1^i\mid X_t)}\right]\\ &amp;= \text{const} - \mathbb{E}_{t,X_0,X_1,X_t} \sum_{X_1^i}\delta(x_1^i,X_1^i) \log{p_{1\mid t}^{\theta,i}( X_1^i\mid X_t)}\\ &amp;\overset{\deltaå‡½æ•°çš„æ€§è´¨}{=} \text{const} - \mathbb{E}_{t,X_0,X_1,X_t} \log{p_{1\mid t}^{\theta,i}(x_1^i\mid X_t)} \end{aligned} \tag{15}\] </blockquote> <p>ç¬¬äºŒç§åšæ³•æ˜¯ä½¿ç”¨<sup id="fnref:1:5"><a href="#fn:1" class="footnote" rel="footnote" role="doc-noteref">1</a></sup>ä¸­å…¬å¼14æ‰€ç¤ºçš„åˆ†è§£CDFMæŸå¤±ï¼Œå¦‚ä¸‹ï¼š</p> \[L_{CDFM}(\theta) = \mathbb{E}_{t,Z,X_t\sim p_{t\mid Z}} \sum_i D_{X_t}^i \left( u_t^i(\cdot,X_t \mid Z), u_t^{\theta,i}(\cdot, X_t) \right) \tag{16}\] <p>å–$Z=(X_0,X_1)$ã€‚ä½¿ç”¨è¯¥å…¬å¼éœ€è¦çŸ¥é“$u_t^{\theta,i}$ï¼Œå› ä¸ºç¥ç»ç½‘ç»œé¢„æµ‹äº†$p_{1\mid t}^{\theta,i}$ï¼Œæ‰€ä»¥$u_t^{\theta,i}$æ˜¯èƒ½ç®—å‡ºæ¥çš„ã€‚</p> <p>å…¬å¼16ä¸­çš„Bregmanæ•£åº¦å¯ä»¥é€‰æ‹©å¹¿ä¹‰çš„KLæŸå¤±ï¼ˆå…¶è¾“å…¥ä¸ä¸€å®šè¦æ˜¯æ¦‚ç‡åˆ†å¸ƒï¼‰ã€‚å…·ä½“è€Œè¨€ï¼Œå¯¹äºå‘é‡$u,v\in \mathbb R_{\ge 0}^{m}$ï¼Œå¹¿ä¹‰KLæŸå¤±æ˜¯ï¼š</p> \[D(u,v) = \sum_j u^j \log \cfrac{u^j}{v^j} - \sum_j u_j + \sum_jv_j \tag{17}\] <p>è¿™ç§é€‰æ‹©ä¸‹å¯¹åº”çš„Bregmanæ•£åº¦ä¸ºï¼š</p> \[D\left(u_t^i(\cdot,x^i\mid x_0,x_1),u^{i,\theta}_t(\cdot,x)\right)= \cfrac{\dot \kappa_t}{1-\kappa_t}\left[ \left(\delta(x_1^i,x^i) - 1\right)\log p_{1\mid t}^{i,\theta}(x_1^i\mid x) + \delta(x_1^i,x^i)- p_{1\mid t}^{i,\theta}(x^i\mid x) \right] \tag{18}\] <h3 id="æ··åˆè½¨è¿¹é‡‡æ ·">æ··åˆè½¨è¿¹é‡‡æ ·</h3> <p>æˆ‘ä»¬åœ¨<sup id="fnref:1:6"><a href="#fn:1" class="footnote" rel="footnote" role="doc-noteref">1</a></sup>ä¸­çš„å…¬å¼5å·²ç»ç»™å‡ºper coordinateçš„é‡‡æ ·æ–¹å¼ï¼Œç»“åˆå‰é¢è®¨è®ºçš„æ··åˆè·¯å¾„ï¼Œé‡‡æ ·å…¬å¼å¯ä»¥å†™ä¸ºï¼š</p> \[\mathbb{P}(X^i_{t+h}=y^i\mid X_t = x) =\delta(y^i,x^i) + h u_t^i(y^i,x) +o(h) \tag{19}\] <p>åœ¨æ··åˆè·¯å¾„çš„ç‰¹å®šæƒ…å†µä¸‹ä¸ºï¼š</p> \[\begin{aligned} \mathbb{P}(X^i_{t+h}=y^i\mid X_t = x) &amp;\overset{å…¬å¼10}{=} \delta(y^i,x^i) + o(h) + h \sum_{x_1^i} \cfrac{\dot \kappa_t}{1 - \kappa_t} \left[ \delta(y^i,x_1^i) - \delta(y^i,x^i) \right]\sum_{x_0,x_1^{\bar i}} p_{0,1\mid t}(x_0,x_1\mid x)\\ &amp;\overset{å…¬å¼11}{=} \delta(y^i,x^i) + o(h) + h \sum_{x_1^i} \cfrac{\dot \kappa_t}{1 - \kappa_t} \left[ \delta(y^i,x_1^i) - \delta(y^i,x^i) \right] p_{1\mid t}^i(x_1^i\mid x)\\ &amp;\overset{\sum_{x_1^i}p_{1\mid t}^i(x_1^i\mid x)=1 }{=} \sum_{x_1^i}\left[ \delta(y^i,x^i) + h \cfrac{\dot \kappa_t}{1 - \kappa_t} \left[ \delta(y^i,x_1^i) - \delta(y^i,x^i) \right] + o(h) \right] p_{1\mid t}^i(x_1^i\mid x)\\ \end{aligned} \tag{20}\] <p>åœ¨å·²çŸ¥$X_t = x$çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨å…¬å¼20è¿›è¡Œé‡‡æ ·çš„å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p> <ol> <li>ä»$p_{1\mid t}^i(X_1^i\mid x)$é‡‡æ ·å‡º$X_1^i$ï¼Œ$X_1^i\sim p_{1\mid t}^i(X_1^i\mid x)$ã€‚$p_{1\mid t}^i(X_1^i\mid x)$æ˜¯ç”±æ¨¡å‹é¢„æµ‹å¾—åˆ°ã€‚</li> <li>åŸºäº$X_t^i$æ›´æ–°å‡º$X_{t+h}^i$ã€‚è¿™ä¸€æ­¥éœ€è¦ä½¿ç”¨<sup id="fnref:5"><a href="#fn:5" class="footnote" rel="footnote" role="doc-noteref">4</a></sup>ä¸­å…¬å¼9æ‰€ç¤ºçš„Euler stepï¼Œå¹¶å°†å…¶ä¸­çš„é€Ÿç‡è®¾ç½®ä¸º$\cfrac{\dot \kappa_t}{1 -\kappa_t}\left[\delta(y^i,X_1^i) - \delta(y^i,x^i)\right]$ã€‚<strong>è¿™ä¸€æ­¥å†³å®šäº†$X_{t+h}^i=X_t^i$è¿˜æ˜¯$X_{t+h}^i=X_1^i$</strong>ã€‚</li> </ol> <h3 id="å•è¾¹æ··åˆè·¯å¾„å’Œä¿æ¦‚ç‡é€Ÿç‡">å•è¾¹æ··åˆè·¯å¾„å’Œä¿æ¦‚ç‡é€Ÿç‡</h3> <p>æˆ‘ä»¬åœ¨ç¬¬ä¸€æ¬¡è®²CTMCçš„é‚£ç¯‡æ–‡ç« <sup id="fnref:5:1"><a href="#fn:5" class="footnote" rel="footnote" role="doc-noteref">4</a></sup>é‡Œé¢çš„æœ€åä¸€éƒ¨åˆ†è®²äº†ä¸€ä¸‹ä¿æ¦‚ç‡é€Ÿç‡ï¼Œåˆ°è¿™é‡Œç»ˆäºè¦ç”¨åˆ°äº†ã€‚</p> <p>ç®€å•å›é¡¾ä¸€ä¸‹åœ¨CTMCæ¨¡å‹é‡Œé¢è®²åˆ°çš„ä¿æ¦‚ç‡é€Ÿç‡ï¼Œå®ƒç®€å•çš„è¯´å°±æ˜¯<strong>åœ¨å·²æœ‰çš„é€Ÿç‡$u_t(y,x)$ä¸­åŠ å…¥å¦ä¸€ä¸ªé€Ÿç‡$v_t(y,x)$ï¼Œåªè¦$v_t(y,x)$æ˜¯divergence-freeçš„ï¼Œé‚£ä¹ˆ$u_t(y,x)$ç”Ÿæˆæ¦‚ç‡è·¯å¾„ä¸ä¼šæ”¹å˜</strong>ã€‚æ‰€è°“divergence-freeï¼ŒæŒ‡$\sum_x v_t(y,x)p_t(x) = 0$ã€‚</p> <p>å¯¹DFMé‡Œé¢çš„åˆ†è§£æ¡ä»¶æ¦‚ç‡è·¯å¾„$p_{t\mid Z}^i(x^i\mid z)$ï¼Œå…¶å¯¹åº”çš„ä¿æ¦‚ç‡æ¡ä»¶é€Ÿç‡$v_t^i(y^i,x^i\mid z)$æ»¡è¶³ï¼š</p> \[\sum_{x^i} v_t^i(y^i,x^i\mid z)p_{t\mid Z}^i(x^i\mid z) = 0 \tag{21}\] <p>ä¸€èˆ¬æ¥è¯´è¿™ä¸ªä¿æ¦‚ç‡æ¡ä»¶é€Ÿç‡$v_t^i(y^i,x^i\mid z)$ä¸æ˜¯ç‰¹åˆ«å¥½æ‰¾åˆ°ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬èƒ½æœ‰å¦‚ä¸‹ä¸¤ä¸ªå‡è®¾ï¼š</p> <ol> <li>iidçš„ç›®æ ‡åˆ†å¸ƒï¼š $p(x) = \prod_i p(x^i)$ã€‚</li> <li>æºåˆ†å¸ƒå’Œç›®æ ‡åˆ†å¸ƒçš„æ•°æ®ç‹¬ç«‹é…å¯¹ï¼š$\pi_{0,1}(x_0,x_1) = p(x_0)q(x_1)$ã€‚</li> </ol> <p>é‚£ä¹ˆä¿æ¦‚ç‡æ¡ä»¶é€Ÿç‡çš„è§£æå¼è¿˜æ˜¯æ¯”è¾ƒå¥½æ‰¾åˆ°çš„ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ¥æ„é€ è¿™ä¸ªä¿æ¦‚ç‡æ¡ä»¶é€Ÿç‡ã€‚</p> <p>æ ¹æ®å‰é¢çš„ä¸¤æ¡å‡è®¾ï¼Œèƒ½å†™å‡ºæ··åˆè·¯å¾„çš„å½¢å¼å¦‚ä¸‹ï¼š</p> \[p_t(x) = \sum_{x_1} p_{t\mid 1}(x\mid x_1)q(x_1) \text{ where } p_{t\mid 1} (x) = \prod_i p_{t\mid 1}^i(x^i \mid x_1)\\ p_{t\mid 1}^i(x^i \mid x_1) = \kappa_t \delta(x^i,x_1^i) + (1 - \kappa_t)p(x^i) \tag{22}\] <p>è¿™ä¸ªå†™æ³•å’Œæˆ‘ä»¬å‰é¢çš„æ··åˆæ¦‚ç‡è·¯å¾„çš„å†™æ³•çš„å·®å¼‚å°±æ˜¯åªç”¨$x_1$ä½œä¸ºæ¡ä»¶ï¼Œä½†å…¶å®å®ƒå’Œç”¨$x_0,x_1$éƒ½ä½œä¸ºæ¡ä»¶åº”è¯¥æ˜¯ç­‰ä»·çš„ã€‚</p> <p>ç±»æ¯”å…¬å¼6</p> \[\begin{aligned} \cfrac{\mathrm{d}}{\mathrm{d}t}p_{t\mid 1}^i(y^i\mid x_1) &amp; \overset{å…¬å¼22}{=} \dot \kappa_t\left[\delta(y^i,x_1^i) - p(x^i)\right] \\ &amp;\overset{ç”¨å…¬å¼22æ¶ˆå»p(x^i)}{=} \dot \kappa_t\left[\delta(y^i,x_1^i) - \cfrac{p^i_{t\mid 1}(y^i\mid x_1)-\kappa_t\delta(y^i,x_1^i)}{1-\kappa_t}\right]\\ &amp;{=} \cfrac{\dot \kappa_t}{1 - \kappa_t}\left[({1-\kappa_t})\delta(y^i,x_1^i) - {p^i_{t\mid 1}(y^i\mid x_1)+\kappa_t\delta(y^i,x_1^i)}\right]\\ &amp;{=} \cfrac{\dot \kappa_t}{1 - \kappa_t} \left[ \delta(y^i,x_1^i) - p^i_{t\mid 1}(y^i\mid x_1) \right]\\ &amp;{=}\sum_{x^i} \cfrac{\dot \kappa_t}{1 - \kappa_t} \left[ \delta(y^i,x_1^i) - \delta(y^i,x^i) \right] p^i_{t\mid 1}(x^i\mid x_1)\\ \end{aligned}\tag{23}\] <p>å¯¹æ¯”Kolmogorovæ–¹ç¨‹ï¼ŒçŸ¥é“ï¼š</p> \[u_t^i(y^i,x^i\mid x_1)=\cfrac{\dot \kappa_t}{1 - \kappa_t} \left[ \delta(y^i,x_1^i) - \delta(y^i,x^i) \right] \tag{24}\] <p>å¯è§$u_t^i(y^i,x^i\mid x_1)$ç”Ÿæˆ$p^i_{t\mid 1}(x^i\mid x_1)$ã€‚å¦‚æœè¦æ‰¾åˆ°å¯¹$p^i_{t\mid 1}(x^i\mid x_1)$è€Œè¨€divergence-freeçš„æ¡ä»¶é€Ÿç‡ï¼Œä¸€ä¸ªç®€å•çš„æŠ€å·§æ˜¯<strong>æ‰¾åˆ°ä¸€ä¸ªå’Œ$u_t^i(y^i,x^i\mid x_1)$æ–¹å‘ç›¸åçš„æ¡ä»¶é€Ÿç‡<sup id="fnref:6"><a href="#fn:6" class="footnote" rel="footnote" role="doc-noteref">5</a></sup>ï¼Œè¿™æ ·åœ¨æ€»æ—¶é—´èŒƒå›´å†…æŠ˜ä¸¤ä¸ªé€Ÿç‡å·®çš„æ•£åº¦å’Œå°±æ˜¯0ï¼Œæ‰€ä»¥è¿™ä¸¤é€Ÿç‡çš„å·®å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„divergence-freeçš„æ¡ä»¶é€Ÿç‡ï¼Œä¹Ÿå°±æ˜¯ä¿æ¦‚ç‡æ¡ä»¶é€Ÿç‡ã€‚</strong>è®°è¿™ä¸ªåå‘çš„æ¡ä»¶é€Ÿç‡ä¸º$\tilde u_t^i(y^i,x^i\mid x_1)$ï¼Œå®ƒçš„å½¢å¼åº”è¯¥æ˜¯ï¼š</p> \[\tilde u_t^i(y^i,x^i\mid x_1) = \cfrac{\dot \kappa_t}{\kappa_t} \left[ \delta(y^i,x^i) - p(x^i) \right] \tag{25}\] <p>è¯æ˜åœ¨<sup id="fnref:6:1"><a href="#fn:6" class="footnote" rel="footnote" role="doc-noteref">5</a></sup>çš„E.5å’ŒE.6ä¸­ã€‚</p> <p>æ‰€ä»¥divergence-freeçš„é€Ÿç‡æ˜¯ï¼š</p> \[v_t^i(y^i,x^i \mid x_1) =u_t^i(y^i,x^i\mid x_1) -\tilde u_t^i(y^i,x^i\mid x_1)\tag{26}\] <p><strong>å› ä¸º$v_t^i(y^i,x^i \mid x_1)$æ˜¯divergence-freeçš„ï¼Œæ‰€ä»¥æŠŠå®ƒä»¥ä»»æ„æ¯”ä¾‹åŠ åˆ°åŸæ¥çš„é€Ÿç‡é‡Œé¢éƒ½ä¸ä¼šå½±å“ç”Ÿæˆçš„æ¦‚ç‡è·¯å¾„</strong>ã€‚æ‰€ä»¥å…¬å¼10æ‰€ç¤ºåˆ†è§£è¾¹ç¼˜é€Ÿç‡å¦‚æœæ”¹å†™æˆä¸‹é¢çš„å½¢å¼ï¼š</p> \[\begin{aligned} u_t^i(y^i,x) &amp;=\sum_{x_1} \left[ u_t^i(y^i,x^i\mid x_1) + c_t v_t^i(y^i,x^i\mid x_1) \right]p_{1\mid t}(x_1 \mid x)\\ &amp;=\sum_{x_1^i} \left[ u_t^i(y^i,x^i\mid x_1^i) + c_t v_t^i(y^i,x^i\mid x_1^i) \right]p^i_{1\mid t}(x^i_1 \mid x)\\ \end{aligned} \tag{27}\\\] <p>ä¸å½±å“æ‰€ç”Ÿæˆçš„è¾¹ç¼˜æ¦‚ç‡è·¯å¾„ã€‚ç¬¬äºŒä¸ªç­‰å¼æ˜¯å› ä¸º$u_t^i(y^i,x^i\mid x_1) =u_t^i(y^i,x^i\mid x_1^i)$ï¼Œ$v_t^i(y^i,x^i\mid x_1) =v_t^i(y^i,x^i\mid x_1^i)$ã€‚</p> <p>é‚£ä¹ˆï¼Œç”¨å…¬å¼27æ‰€ç¤ºçš„é€Ÿç‡è¿›è¡Œé‡‡æ ·çš„æ­¥éª¤æ˜¯ï¼š</p> <ol> <li> <p>ä»$p_{1\mid t}^i(X_1^i\mid x)$é‡‡æ ·å‡º$X_1^i$ï¼Œ$X_1^i\sim p_{1\mid t}^i(X_1^i\mid x)$ã€‚$p_{1\mid t}^i(X_1^i\mid x)$æ˜¯ç”±æ¨¡å‹é¢„æµ‹å¾—åˆ°ã€‚</p> </li> <li> <p>åŸºäº$X_t^i$æ›´æ–°å‡º$X_{t+h}^i$ã€‚è¿™ä¸€æ­¥éœ€è¦ä½¿ç”¨<sup id="fnref:5:2"><a href="#fn:5" class="footnote" rel="footnote" role="doc-noteref">4</a></sup>ä¸­å…¬å¼9æ‰€ç¤ºçš„Euler stepï¼Œå¹¶å°†å…¶ä¸­çš„é€Ÿç‡è®¾ç½®ä¸º</p> \[u_t^i(y^i,x^i\mid x_1) = \cfrac{\dot \kappa_t}{1-\kappa_t}\left[\delta(y^i,X_1^i) - \delta(y^i,x^i)\right] +c_t\left[ \cfrac{\dot \kappa_t}{1-\kappa_t}\left[\delta(y^i,x_1^i) - \delta(y^i,x^i)\right] - \cfrac{\dot \kappa_t}{\kappa_t} \left[\delta(y^i,x^i) - p(x^i)\right] \right] \tag{28}\] <p>å…¶ä¸­$c_t&gt;0$æ˜¯ä¸æ—¶é—´ç›¸å…³çš„å¸¸æ•°ã€‚</p> </li> </ol> <p>åœ¨<a href="https://github.com/facebookresearch/flow_matching" rel="external nofollow noopener" target="_blank">https://github.com/facebookresearch/flow_matching</a>åº“é‡Œé¢å®ç°çš„DFMçš„ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">torch</span>  

<span class="kn">from</span> <span class="n">flow_matching.path</span> <span class="kn">import</span> <span class="n">MixtureDiscreteProbPath</span><span class="p">,</span> <span class="n">DiscretePathSample</span>  
<span class="kn">from</span> <span class="n">flow_matching.path.scheduler</span> <span class="kn">import</span> <span class="n">PolynomialConvexScheduler</span>  
<span class="kn">from</span> <span class="n">flow_matching.loss</span> <span class="kn">import</span> <span class="n">MixturePathGeneralizedKL</span>  
<span class="kn">from</span> <span class="n">flow_matching.solver</span> <span class="kn">import</span> <span class="n">MixtureDiscreteEulerSolver</span>  
<span class="kn">from</span> <span class="n">flow_matching.utils</span> <span class="kn">import</span> <span class="n">ModelWrapper</span>  

<span class="c1"># Define a trainable velocity model  
</span><span class="n">model</span> <span class="o">=</span> <span class="p">...</span>   

<span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">optim</span><span class="p">.</span><span class="nc">Adam</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="nf">parameters</span><span class="p">())</span>  

<span class="n">scheduler</span> <span class="o">=</span> <span class="nc">PolynomialConvexScheduler</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>  
<span class="n">path</span> <span class="o">=</span> <span class="nc">MixtureDiscreteProbPath</span><span class="p">(</span><span class="n">scheduler</span><span class="o">=</span><span class="n">scheduler</span><span class="p">)</span>  
<span class="n">loss_fn</span> <span class="o">=</span> <span class="nc">MixturePathGeneralizedKL</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>  <span class="c1"># Generalized KL Bregman divergence  
</span>
<span class="k">for</span> <span class="n">x_0</span><span class="p">,</span> <span class="n">x_1</span> <span class="ow">in</span> <span class="n">dataloader</span><span class="p">:</span>  <span class="c1"># Samples from Ï€0,1 of shape [batch_size, *data_dim]  
</span>    <span class="n">t</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">rand</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-3</span><span class="p">)</span>  <span class="c1"># Randomize time t âˆ¼ U [0, 1 âˆ’ 10âˆ’3]  
</span>    <span class="n">sample</span><span class="p">:</span> <span class="n">DiscretePathSample</span> <span class="o">=</span> <span class="n">path</span><span class="p">.</span><span class="nf">sample</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">x_0</span><span class="o">=</span><span class="n">x_0</span><span class="p">,</span> <span class="n">x_1</span><span class="o">=</span><span class="n">x_1</span><span class="p">)</span>  <span class="c1"># Sample the conditional path  
</span>    <span class="n">model_output</span> <span class="o">=</span> <span class="nf">model</span><span class="p">(</span><span class="n">sample</span><span class="p">.</span><span class="n">x_t</span><span class="p">,</span> <span class="n">sample</span><span class="p">.</span><span class="n">t</span><span class="p">)</span>  

    <span class="n">loss</span> <span class="o">=</span> <span class="nf">loss_fn</span><span class="p">(</span><span class="n">logits</span><span class="o">=</span><span class="n">model_output</span><span class="p">,</span> <span class="n">x_1</span><span class="o">=</span><span class="n">sample</span><span class="p">.</span><span class="n">x_1</span><span class="p">,</span> <span class="n">x_t</span><span class="o">=</span><span class="n">sample</span><span class="p">.</span><span class="n">x_t</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">sample</span><span class="p">.</span><span class="n">t</span><span class="p">)</span>  <span class="c1"># CDFM loss  
</span>
    <span class="n">optimizer</span><span class="p">.</span><span class="nf">zero_grad</span><span class="p">()</span>  
    <span class="n">loss</span><span class="p">.</span><span class="nf">backward</span><span class="p">()</span>  
    <span class="n">optimizer</span><span class="p">.</span><span class="nf">step</span><span class="p">()</span>  

<span class="k">class</span> <span class="nc">ProbabilityDenoiser</span><span class="p">(</span><span class="n">ModelWrapper</span><span class="p">):</span>  
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="p">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">torch</span><span class="p">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="o">**</span><span class="n">extras</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="p">.</span><span class="n">Tensor</span><span class="p">:</span>  
        <span class="n">logits</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">model</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="o">**</span><span class="n">extras</span><span class="p">)</span>  
        <span class="k">return</span> <span class="n">torch</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="n">functional</span><span class="p">.</span><span class="nf">softmax</span><span class="p">(</span><span class="n">logits</span><span class="p">.</span><span class="nf">float</span><span class="p">(),</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>  

<span class="c1"># Sample X1  
</span><span class="n">probability_denoiser</span> <span class="o">=</span> <span class="nc">ProbabilityDenoiser</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>  
<span class="n">x_0</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="n">batch_size</span><span class="p">,</span> <span class="o">*</span><span class="n">data_dim</span><span class="p">])</span>  <span class="c1"># Specify the initial condition  
</span><span class="n">solver</span> <span class="o">=</span> <span class="nc">MixtureDiscreteEulerSolver</span><span class="p">(</span>  
    <span class="n">model</span><span class="o">=</span><span class="n">probability_denoiser</span><span class="p">,</span>  
    <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>  
    <span class="n">vocabulary_size</span><span class="o">=</span><span class="n">vocabulary_size</span>  
<span class="p">)</span>  

<span class="n">step_size</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">100</span>  
<span class="n">x_1</span> <span class="o">=</span> <span class="n">solver</span><span class="p">.</span><span class="nf">sample</span><span class="p">(</span><span class="n">x_init</span><span class="o">=</span><span class="n">x_0</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="n">step_size</span><span class="p">,</span> <span class="n">time_grid</span><span class="o">=</span><span class="n">torch</span><span class="p">.</span><span class="nf">tensor</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-3</span><span class="p">]))</span>
</code></pre></div></div> <p>ä¸€ä¸ªç‹¬ç«‹çš„DFMçš„ä»£ç æ¡ˆä¾‹å¦‚ä¸‹ï¼š</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">torch</span>  
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>  
<span class="kn">from</span> <span class="n">torch</span> <span class="kn">import</span> <span class="n">nn</span><span class="p">,</span> <span class="n">Tensor</span>  
<span class="kn">from</span> <span class="n">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_moons</span>  

<span class="k">class</span> <span class="nc">DiscreteFlow</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>  
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">h</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">):</span>  
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">()</span>  
        <span class="n">self</span><span class="p">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">v</span>  
        <span class="n">self</span><span class="p">.</span><span class="n">embed</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Embedding</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>  
        <span class="n">self</span><span class="p">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Sequential</span><span class="p">(</span>  
            <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="n">dim</span> <span class="o">*</span> <span class="n">h</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="n">nn</span><span class="p">.</span><span class="nc">ELU</span><span class="p">(),</span>  
            <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="n">nn</span><span class="p">.</span><span class="nc">ELU</span><span class="p">(),</span>  
            <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="n">nn</span><span class="p">.</span><span class="nc">ELU</span><span class="p">(),</span>  
            <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">dim</span> <span class="o">*</span> <span class="n">v</span><span class="p">)</span>  
        <span class="p">)</span>  

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">x_t</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>  
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">net</span><span class="p">(</span>  
            <span class="n">torch</span><span class="p">.</span><span class="nf">cat</span><span class="p">(</span>  
                <span class="p">(</span><span class="n">t</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">],</span> <span class="n">self</span><span class="p">.</span><span class="nf">embed</span><span class="p">(</span><span class="n">x_t</span><span class="p">).</span><span class="nf">flatten</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="o">-</span><span class="mi">1</span>  
            <span class="p">)</span>  
        <span class="p">).</span><span class="nf">reshape</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">x_t</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">v</span><span class="p">])</span>  

<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">256</span>  
<span class="n">vocab_size</span> <span class="o">=</span> <span class="mi">128</span>  

<span class="n">model</span> <span class="o">=</span> <span class="nc">DiscreteFlow</span><span class="p">(</span><span class="n">v</span><span class="o">=</span><span class="n">vocab_size</span><span class="p">)</span>  
<span class="n">optim</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">optim</span><span class="p">.</span><span class="nc">Adam</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="nf">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>  

<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>  
    <span class="n">x_1</span> <span class="o">=</span> <span class="nc">Tensor</span><span class="p">(</span><span class="nf">make_moons</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>  
    <span class="n">x_1</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">round</span><span class="p">(</span><span class="n">torch</span><span class="p">.</span><span class="nf">clip</span><span class="p">(</span><span class="n">x_1</span> <span class="o">*</span> <span class="mi">35</span> <span class="o">+</span> <span class="mi">50</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">vocab_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)).</span><span class="nf">long</span><span class="p">()</span>  
    <span class="n">x_0</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>  

    <span class="n">t</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">rand</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span>  
    <span class="n">x_t</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="n">torch</span><span class="p">.</span><span class="nf">rand</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">t</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">],</span> <span class="n">x_1</span><span class="p">,</span> <span class="n">x_0</span><span class="p">)</span>  

    <span class="n">logits</span> <span class="o">=</span> <span class="nf">model</span><span class="p">(</span><span class="n">x_t</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>  
    <span class="n">loss</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">functional</span><span class="p">.</span><span class="nf">cross_entropy</span><span class="p">(</span><span class="n">logits</span><span class="p">.</span><span class="nf">flatten</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x_1</span><span class="p">.</span><span class="nf">flatten</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)).</span><span class="nf">mean</span><span class="p">()</span>  
    <span class="n">optim</span><span class="p">.</span><span class="nf">zero_grad</span><span class="p">()</span>  
    <span class="n">loss</span><span class="p">.</span><span class="nf">backward</span><span class="p">()</span>  
    <span class="n">optim</span><span class="p">.</span><span class="nf">step</span><span class="p">()</span>  

<span class="n">x_t</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>  
<span class="n">t</span> <span class="o">=</span> <span class="mf">0.0</span>  
<span class="n">results</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x_t</span><span class="p">,</span> <span class="n">t</span><span class="p">)]</span>  
<span class="k">while</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-3</span><span class="p">:</span>  
    <span class="n">p1</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">softmax</span><span class="p">(</span><span class="nf">model</span><span class="p">(</span><span class="n">x_t</span><span class="p">,</span> <span class="n">torch</span><span class="p">.</span><span class="nf">ones</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span><span class="p">),</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>  
    <span class="n">h</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span>  
    <span class="n">one_hot_x_t</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">functional</span><span class="p">.</span><span class="nf">one_hot</span><span class="p">(</span><span class="n">x_t</span><span class="p">,</span> <span class="n">vocab_size</span><span class="p">).</span><span class="nf">float</span><span class="p">()</span>  
    <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="n">p1</span> <span class="o">-</span> <span class="n">one_hot_x_t</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span>  
    <span class="n">x_t</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">distributions</span><span class="p">.</span><span class="nc">Categorical</span><span class="p">(</span><span class="n">probs</span><span class="o">=</span><span class="n">one_hot_x_t</span> <span class="o">+</span> <span class="n">h</span> <span class="o">*</span> <span class="n">u</span><span class="p">).</span><span class="nf">sample</span><span class="p">()</span>  
    <span class="n">t</span> <span class="o">+=</span> <span class="n">h</span>  
    <span class="n">results</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span><span class="n">x_t</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>  

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">results</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  
<span class="nf">for </span><span class="p">(</span><span class="n">x_t</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nf">zip</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">axes</span><span class="p">):</span>  
    <span class="n">ax</span><span class="p">.</span><span class="nf">scatter</span><span class="p">(</span><span class="n">x_t</span><span class="p">.</span><span class="nf">detach</span><span class="p">()[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x_t</span><span class="p">.</span><span class="nf">detach</span><span class="p">()[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  
    <span class="n">ax</span><span class="p">.</span><span class="nf">set_title</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">t=</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>  
<span class="n">plt</span><span class="p">.</span><span class="nf">tight_layout</span><span class="p">()</span>  
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div> <p>DFMç”Ÿæˆæ•ˆæœå¦‚ä¸‹ï¼š</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/post/DFM33-480.webp 480w,/assets/img/post/DFM33-800.webp 800w,/assets/img/post/DFM33-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/post/DFM33.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> DFMç”Ÿæˆæ•ˆæœ </div> <div class="footnotes" role="doc-endnotes"> <ol> <li id="fn:1"> <p><a href="https://zhuanlan.zhihu.com/p/18450992825" rel="external nofollow noopener" target="_blank">https://zhuanlan.zhihu.com/p/18450992825</a>Â <a href="#fnref:1" class="reversefootnote" role="doc-backlink">â†©</a>Â <a href="#fnref:1:1" class="reversefootnote" role="doc-backlink">â†©<sup>2</sup></a>Â <a href="#fnref:1:2" class="reversefootnote" role="doc-backlink">â†©<sup>3</sup></a>Â <a href="#fnref:1:3" class="reversefootnote" role="doc-backlink">â†©<sup>4</sup></a>Â <a href="#fnref:1:4" class="reversefootnote" role="doc-backlink">â†©<sup>5</sup></a>Â <a href="#fnref:1:5" class="reversefootnote" role="doc-backlink">â†©<sup>6</sup></a>Â <a href="#fnref:1:6" class="reversefootnote" role="doc-backlink">â†©<sup>7</sup></a></p> </li> <li id="fn:2"> <p>Lipman Y, Chen R T Q, Ben-Hamu H, et al. Flow matching for generative modeling[J]. arXiv preprint arXiv:2210.02747, 2022.Â <a href="#fnref:2" class="reversefootnote" role="doc-backlink">â†©</a>Â <a href="#fnref:2:1" class="reversefootnote" role="doc-backlink">â†©<sup>2</sup></a></p> </li> <li id="fn:3"> <p>Liu X, Gong C, Liu Q. Flow straight and fast: Learning to generate and transfer data with rectified flow[J]. arXiv preprint arXiv:2209.03003, 2022.Â <a href="#fnref:3" class="reversefootnote" role="doc-backlink">â†©</a></p> </li> <li id="fn:5"> <p><a href="https://zhuanlan.zhihu.com/p/16026053810" rel="external nofollow noopener" target="_blank">https://zhuanlan.zhihu.com/p/16026053810</a>Â <a href="#fnref:5" class="reversefootnote" role="doc-backlink">â†©</a>Â <a href="#fnref:5:1" class="reversefootnote" role="doc-backlink">â†©<sup>2</sup></a>Â <a href="#fnref:5:2" class="reversefootnote" role="doc-backlink">â†©<sup>3</sup></a></p> </li> <li id="fn:6"> <p>Gat I, Remez T, Shaul N, et al. Discrete flow matching[J]. arXiv preprint arXiv:2407.15595, 2024.Â <a href="#fnref:6" class="reversefootnote" role="doc-backlink">â†©</a>Â <a href="#fnref:6:1" class="reversefootnote" role="doc-backlink">â†©<sup>2</sup></a></p> </li> </ol> </div> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/%E7%A6%BB%E6%95%A3%E6%B5%81%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-2/">ç¦»æ•£å‹æµåŒ¹é…æ¨¡å‹ï¼ˆ2ï¼‰</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/%E7%A6%BB%E6%95%A3%E6%B5%81%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%9E%8B-1/">ç¦»æ•£å‹æµåŒ¹é…æ¨¡å‹ï¼ˆ1ï¼‰</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/%E8%BF%9E%E7%BB%AD%E6%97%B6%E9%97%B4%E7%9A%84%E9%A9%AC%E5%8F%AF%E5%A4%AB%E9%93%BE/">è¿ç»­æ—¶é—´çš„é©¬å¯å¤«é“¾</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> Â© Copyright 2025 Yi LIU. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?c999e8c5281874b7534e3352f835d4c3" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?b977fe0c21b2118ed853308b1b923969"></script> <script src="/assets/js/no_defer.js?699fa7cbe3b29f831db7d5250ba3203a"></script> <script defer src="/assets/js/common.js?d3a25b46bbd2e0a751a27b173abc6e5f"></script> <script defer src="/assets/js/copy_code.js?fff63901a03063094790ffbfd4bc0cb4" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?25eff8ff4144a010e4ad7b31403102cf"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?04761245f225e3ad9e5e3f875d4e1074"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?b78cb42895d74e4fd6de6f633edcf181" type="text/javascript"></script> <script src="/assets/js/tabs.min.js?b3298908ffcca362ac4f3e3a7a7ebe94"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?230637657ac0b42e92d76e2b4c1b4764"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?ade73d6d60912d119f9c9347bc176630"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?f74bfa9a88ab862fb9df1c46146b7b7d"></script> </body> </html>